<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BPB Panel v4.6 (Release)</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.0.3/misc/Farsi-Digits/Vazirmatn-FD-font-face.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="toast-container"></div>

    <div id="obfuscation-overlay">
        <i class="fas fa-fingerprint fa-4x fa-spin" style="color: var(--purple); margin-bottom: 20px;"></i>
        <div class="matrix-text" id="obfuscate-msg">INITIALIZING SYSTEM...</div>
    </div>

    <div id="login-overlay">
        <div class="login-box">
            <div style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"><i class="fas fa-shield-alt"></i></div>
            <h1 style="margin-bottom: 10px; font-weight: 700;" data-i18n="app_title">BPB Panel</h1>
            <p style="color: var(--text-muted); margin-bottom: 30px;" data-i18n="login_subtitle">Worker Management System v4.6</p>
            <form onsubmit="event.preventDefault(); handleLogin();">
                <div class="form-group" style="text-align: left;">
                    <label data-i18n="login_password_label">Password</label>
                    <input type="password" id="login-pass" class="form-control" style="text-align: center; font-size: 1.1rem; padding: 12px;">
                </div>
                <button type="submit" class="btn btn-primary btn-full" style="padding: 12px; font-size: 1rem;">
                    <span data-i18n="login_btn">Login</span> <i class="fas fa-arrow-right"></i>
                </button>
            </form>
            <p style="margin-top: 20px; font-size: 0.8rem; color: var(--text-muted); opacity: 0.7;" data-i18n="login_hint">Tip: Demo Mode, enter any password.</p>
        </div>
    </div>

    <div id="app-container">
        <div class="mobile-menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>

        <aside class="sidebar" id="sidebar">
            <div class="brand"><i class="fas fa-bolt"></i> <span data-i18n="app_title">BPB Panel</span> <span>v4.6</span></div>
            <nav class="nav-menu">
                <div class="nav-item active" onclick="switchTab('dashboard', this)"><i class="fas fa-chart-pie"></i> <span data-i18n="menu_dashboard">Dashboard</span></div>
                <div class="nav-item" onclick="switchTab('protocols', this)"><i class="fas fa-network-wired"></i> <span data-i18n="menu_protocols">Protocols & Ports</span></div>
                <div class="nav-item" onclick="switchTab('general', this)"><i class="fas fa-sliders-h"></i> <span data-i18n="menu_general">General Settings</span></div>
                <div class="nav-item" onclick="switchTab('fragment', this)"><i class="fas fa-puzzle-piece"></i> <span data-i18n="menu_fragment">Fragment</span></div>
                <div class="nav-item" onclick="switchTab('warp', this)"><i class="fab fa-cloudflare"></i> <span data-i18n="menu_warp">Warp & Pro</span></div>
                <div class="nav-item" onclick="switchTab('routing', this)"><i class="fas fa-route"></i> <span data-i18n="menu_routing">Routing Rules</span></div>
                <div class="nav-item" onclick="switchTab('chain', this)"><i class="fas fa-link"></i> <span data-i18n="menu_chain">Chain Proxy</span></div>
                <div class="nav-item" onclick="switchTab('scanner', this)"><i class="fas fa-satellite-dish"></i> <span data-i18n="menu_scanner">IP Scanner</span></div>
                <div class="nav-item" onclick="switchTab('kv-editor', this)"><i class="fas fa-database"></i> <span data-i18n="menu_kv">KV Editor</span></div>
            </nav>
            <div class="user-panel">
                <div class="user-info-row">
                    <div style="width: 35px; height: 35px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">A</div>
                    <div style="flex: 1; margin-left: 10px;">
                        <div style="font-weight: 600; font-size: 0.9rem;" data-i18n="user_admin">Admin User</div>
                        <div style="font-size: 0.75rem; color: var(--success);" data-i18n="user_online">Online</div>
                    </div>
                    <button class="btn btn-danger" style="padding: 8px;" onclick="location.reload()"><i class="fas fa-power-off"></i></button>
                </div>
                <select class="lang-select" onchange="changeLanguage(this.value)">
                    <option value="en">üá∫üá∏ English</option>
                    <option value="zh">üá®üá≥ ÁÆÄ‰Ωì‰∏≠Êñá</option>
                    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
                    <option value="fa">üáÆüá∑ ŸÅÿßÿ±ÿ≥€å (Iran)</option>
                </select>
            </div>
        </aside>

        <main class="main-content">
            
            <section id="dashboard" class="section active">
                <div class="header-bar">
                    <div>
                        <h2 data-i18n="menu_dashboard">Dashboard</h2>
                        <p style="color: var(--text-muted);" data-i18n="dashboard_desc">Overview of system status and quick actions.</p>
                    </div>
                    <button class="btn btn-primary" onclick="fetchMyIP()"><i class="fas fa-sync-alt"></i> <span data-i18n="btn_refresh_ip">Refresh IP</span></button>
                </div>

                <div class="card" style="border: 1px solid var(--purple); background: rgba(139, 92, 246, 0.05);">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <div style="color: var(--purple); font-weight: 700; font-size: 1.1rem; margin-bottom: 5px;">
                                <i class="fas fa-magic"></i> <span data-i18n="card_ai_title">AI Smart Obfuscate</span>
                            </div>
                            <div style="color: var(--text-muted); font-size: 0.9rem;" data-i18n="card_ai_desc">Automatically randomize Fragment length, interval, and Warp noise to evade detection.</div>
                        </div>
                        <button class="btn btn-purple" onclick="runSmartObfuscation()"><i class="fas fa-fingerprint"></i> <span data-i18n="btn_run_obfuscate">Run Smart Obfuscate</span></button>
                    </div>
                </div>

                <div class="grid-3">
                    <div class="card">
                        <div class="card-title"><i class="fas fa-globe"></i> <span data-i18n="card_ip_title">Current IP</span></div>
                        <h2 id="dashboard-ip" style="font-size: 1.8rem; margin: 10px 0;">Loading...</h2>
                        <p id="dashboard-loc" style="color: var(--text-muted);" data-i18n="status_checking">Checking...</p>
                    </div>
                    <div class="card">
                        <div class="card-title"><i class="fas fa-server"></i> <span data-i18n="card_status_title">Worker Status</span></div>
                        <div style="margin-top: 15px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span data-i18n="label_cpu">CPU Usage</span> <span style="color: var(--success);">Low</span></div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;"><span data-i18n="label_requests">Requests (24h)</span> <span>14,205</span></div>
                             <div style="display: flex; justify-content: space-between;"><span data-i18n="label_kv_writes">KV Writes</span> <span>12/1000</span></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-title"><i class="fas fa-link"></i> <span data-i18n="card_actions_title">Quick Actions</span></div>
                        <div style="display: flex; gap: 10px; flex-direction: column;">
                            <button class="btn btn-secondary" onclick="showToast(translations[currentLang].msg_copy, 'success')"><i class="fas fa-copy"></i> <span data-i18n="btn_copy_sub">Copy Sub Link</span></button>
                            <button class="btn btn-secondary" onclick="showToast(translations[currentLang].msg_download, 'success')"><i class="fas fa-download"></i> <span data-i18n="btn_export_clash">Export Clash</span></button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="protocols" class="section">
                <div class="header-bar">
                    <h2 data-i18n="menu_protocols">Protocols & Ports</h2>
                    <button class="btn btn-success" onclick="saveSettings()"><i class="fas fa-save"></i> <span data-i18n="btn_save">Save Changes</span></button>
                </div>
                <div class="card">
                    <div class="card-title" data-i18n="card_enabled_protocols">Enabled Protocols</div>
                    <div class="grid-2">
                        <div class="toggle-row"><span data-i18n="toggle_vless">Enable <b>VLESS</b> Configs</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
                        <div class="toggle-row"><span data-i18n="toggle_trojan">Enable <b>Trojan</b> Configs</span><label class="switch"><input type="checkbox"><span class="slider"></span></label></div>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-title">HTTPS Ports (TLS)</div>
                        <p style="margin-bottom: 15px; font-size: 0.9rem; color: var(--text-muted);" data-i18n="desc_tls_ports">Cloudflare supported TLS ports.</p>
                        <div class="grid-ports" id="https-ports-container"></div>
                    </div>
                    <div class="card">
                        <div class="card-title">HTTP Ports (Non-TLS)</div>
                        <p style="margin-bottom: 15px; font-size: 0.9rem; color: var(--text-muted);" data-i18n="desc_http_ports">Cloudflare supported non-TLS ports.</p>
                         <div class="grid-ports" id="http-ports-container"></div>
                    </div>
                </div>
            </section>

            <section id="general" class="section">
                <div class="header-bar">
                    <h2 data-i18n="menu_general">General Settings</h2>
                    <button class="btn btn-success" onclick="saveSettings()"><i class="fas fa-save"></i> <span data-i18n="btn_save">Save Changes</span></button>
                </div>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-title" data-i18n="card_dns">DNS Configuration</div>
                        <div class="form-group"><label data-i18n="label_remote_dns">Remote DNS (DoH)</label><input type="text" class="form-control" value="https://8.8.8.8/dns-query"></div>
                        <div class="form-group"><label data-i18n="label_local_dns">Local DNS</label><input type="text" class="form-control" value="8.8.8.8"></div>
                         <div class="toggle-row" style="margin-top: 20px;"><span data-i18n="toggle_fakedns">Enable FakeDNS</span><label class="switch"><input type="checkbox"><span class="slider"></span></label></div>
                    </div>
                    <div class="card">
                        <div class="card-title" data-i18n="card_network">Network & IP</div>
                        <div class="form-group"><label data-i18n="label_proxy_ip">Proxy IP / Clean IP</label><input type="text" id="general-proxy-ip" class="form-control" value="www.visa.com.sg"><small style="color: var(--text-muted); display:block; margin-top:5px;" data-i18n="desc_proxy_ip">Used to proxy traffic through a clean Cloudflare IP.</small></div>
                        <div class="toggle-row" style="margin-top: 15px;"><span data-i18n="toggle_ipv6">Enable IPv6 Support</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
                         <div class="toggle-row"><span><span data-i18n="toggle_ech">Enable ECH (Secure Hello)</span> <span style="font-size:0.7rem; color:var(--purple); border:1px solid var(--purple); padding:1px 3px; border-radius:3px;">v4.1</span></span><label class="switch"><input type="checkbox"><span class="slider"></span></label></div>
                    </div>
                </div>
            </section>

            <section id="fragment" class="section">
                <div class="header-bar">
                    <h2 data-i18n="menu_fragment">Fragment Settings</h2>
                    <button class="btn btn-success" onclick="saveSettings()"><i class="fas fa-save"></i> <span data-i18n="btn_save">Save Changes</span></button>
                </div>
                <div class="card">
                    <p style="color: var(--text-muted); margin-bottom: 20px;" data-i18n="desc_fragment">Splits TLS packets into smaller chunks to bypass SNI blocking.</p>
                    <div class="grid-3">
                        <div class="form-group"><label data-i18n="label_length">Length (Min - Max)</label><div style="display: flex; gap: 10px;"><input type="number" id="frag-len-min" class="form-control" value="100"><input type="number" id="frag-len-max" class="form-control" value="200"></div></div>
                        <div class="form-group"><label data-i18n="label_interval">Interval (Min - Max ms)</label><div style="display: flex; gap: 10px;"><input type="number" id="frag-int-min" class="form-control" value="10"><input type="number" id="frag-int-max" class="form-control" value="20"></div></div>
                        <div class="form-group"><label data-i18n="label_packets">Packets</label><select class="form-control" id="frag-packets"><option value="tlshello">tlshello</option><option value="1-1">1-1</option><option value="1-3">1-3</option></select></div>
                    </div>
                </div>
            </section>

            <section id="warp" class="section">
                <div class="header-bar">
                    <h2 data-i18n="menu_warp">Warp & Warp Pro</h2>
                    <button class="btn btn-success" onclick="saveSettings()"><i class="fas fa-save"></i> <span data-i18n="btn_save">Save Changes</span></button>
                </div>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-title" data-i18n="card_warp_account">Warp Account</div>
                         <div class="form-group"><label data-i18n="label_warp_key">Warp Plus License Key</label><input type="text" class="form-control" placeholder="xxxxxxxx-xxxxxxxx-xxxxxxxx"></div>
                         <div class="form-group"><label data-i18n="label_warp_endpoint">Warp Endpoint</label><input type="text" class="form-control" value="engage.cloudflareclient.com:2408"></div>
                    </div>
                    <div class="card">
                        <div class="card-title" data-i18n="card_warp_pro">Warp Pro (Obfuscation)</div>
                         <div class="form-group"><label data-i18n="label_noise_mode">UDP Noise Mode</label><select class="form-control" id="warp-noise"><option value="quic">quic</option><option value="random">random</option><option value="disabled">disabled</option></select></div>
                         <div class="form-group"><label data-i18n="label_noise_apply">Noise Apply To (v4.1)</label><select class="form-control"><option value="udp">UDP Only</option><option value="tcp">TCP Only</option><option value="all">Both (All)</option></select></div>
                    </div>
                </div>
            </section>

            <section id="routing" class="section">
                <div class="header-bar">
                    <h2 data-i18n="menu_routing">Routing Rules</h2>
                    <button class="btn btn-success" onclick="saveSettings()"><i class="fas fa-save"></i> <span data-i18n="btn_save">Save Changes</span></button>
                </div>
                <div class="card">
                    <div class="card-title" data-i18n="card_predefined_rules">Pre-defined Rules</div>
                    <div class="grid-2">
                         <div class="toggle-row"><span data-i18n="toggle_ads">Block Ads & Trackers</span><label class="switch"><input type="checkbox"><span class="slider"></span></label></div>
                         <div class="toggle-row"><span data-i18n="toggle_porn">Block Pornography</span><label class="switch"><input type="checkbox"><span class="slider"></span></label></div>
                        <div class="toggle-row"><span data-i18n="toggle_quic">Block QUIC (UDP)</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
                        <div class="toggle-row"><span data-i18n="toggle_lan">Bypass LAN / Private IP</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
                        <div class="toggle-row"><span data-i18n="toggle_cn">Bypass China (CN)</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
                        <div class="toggle-row"><span data-i18n="toggle_ir">Bypass Iran (IR)</span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
                         <div class="toggle-row"><span data-i18n="toggle_ru">Bypass Russia (RU)</span><label class="switch"><input type="checkbox"><span class="slider"></span></label></div>
                         <div class="toggle-row"><span><i class="fab fa-google"></i> <span data-i18n="toggle_google_ai">Bypass Google AI</span></span><label class="switch"><input type="checkbox" checked><span class="slider"></span></label></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title" data-i18n="card_custom_rules">Custom Rules</div>
                    <div class="form-group"><label data-i18n="label_custom_bypass">Custom Bypass IPs/Domains</label><textarea class="form-control" rows="3" placeholder="example.com, 1.2.3.4"></textarea></div>
                     <div class="form-group"><label data-i18n="label_custom_block">Custom Block IPs/Domains</label><textarea class="form-control" rows="3" placeholder="ads.example.com"></textarea></div>
                </div>
            </section>

            <section id="chain" class="section">
                <div class="header-bar">
                    <h2 data-i18n="menu_chain">Chain Proxy</h2>
                    <button class="btn btn-success" onclick="saveSettings()"><i class="fas fa-save"></i> <span data-i18n="btn_save">Save Changes</span></button>
                </div>
                <div class="card">
                    <div class="toggle-row" style="margin-bottom: 20px;"><span data-i18n="toggle_enable_chain">Enable Chain Proxy</span><label class="switch"><input type="checkbox" id="chain-toggle" onchange="toggleChainFields()"><span class="slider"></span></label></div>
                    <div id="chain-fields" style="display: none; opacity: 0; transition: opacity 0.3s;">
                        <div class="grid-3">
                            <div class="form-group"><label data-i18n="label_protocol">Protocol</label><select class="form-control"><option value="socks5">Socks5</option><option value="http">HTTP</option><option value="vless">VLESS</option></select></div>
                            <div class="form-group"><label data-i18n="label_server">Server Address</label><input type="text" class="form-control" placeholder="1.2.3.4"></div>
                            <div class="form-group"><label data-i18n="label_port">Port</label><input type="number" class="form-control" placeholder="1080"></div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group"><label data-i18n="label_username">Username / UUID</label><input type="text" class="form-control"></div>
                            <div class="form-group"><label data-i18n="label_password">Password</label><input type="password" class="form-control"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="scanner" class="section">
                <div class="header-bar">
                    <h2 data-i18n="menu_scanner">Auto IP Scanner</h2>
                </div>
                <div class="card">
                    <div class="grid-3">
                         <div class="form-group"><label data-i18n="label_max_latency">Max Latency (ms)</label><input type="number" class="form-control" value="300"></div>
                         <div class="form-group"><label data-i18n="label_scan_threads">Scan Threads</label><input type="number" class="form-control" value="5"></div>
                         <div style="display: flex; align-items: flex-end;">
                             <div class="toggle-row" style="width: 100%; margin-bottom: 0; padding: 10px;"><span style="font-weight: 600;" data-i18n="toggle_auto_apply">Auto-Apply Best IP</span><label class="switch"><input type="checkbox" id="auto-apply-ip" checked><span class="slider"></span></label></div>
                         </div>
                    </div>
                     <button class="btn btn-primary btn-full" id="scan-btn" onclick="toggleScan()" style="margin-top: 20px;">
                        <i class="fas fa-play"></i> <span data-i18n="btn_start_scan">Start Scan</span>
                    </button>
                </div>
                <div class="card">
                    <div class="card-title" data-i18n="card_scan_log">Scanner Log</div>
                    <div class="terminal-window" id="scan-log">
                        <div>> Ready to scan Cloudflare IPs...</div>
                        <div>> Waiting for user command.</div>
                    </div>
                </div>
            </section>

            <section id="kv-editor" class="section">
                <div class="header-bar">
                    <h2 data-i18n="menu_kv">KV Editor</h2>
                    <button class="btn btn-danger" onclick="showToast(translations[currentLang].msg_kv_warn, 'warning')"><i class="fas fa-exclamation-triangle"></i> <span data-i18n="btn_force_write">Force Write</span></button>
                </div>
                <div class="card">
                    <p style="color: var(--text-muted); margin-bottom: 10px;" data-i18n="desc_kv">Directly edit the JSON configuration stored in KV.</p>
                    <textarea class="form-control" style="height: 400px; background: #0f172a; color: #a5b4fc; border: 1px solid #334155;">{ "settings": { "vless": { "uuid": "550e8400-e29b-41d4-a716-446655440000" } } }</textarea>
                </div>
            </section>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>